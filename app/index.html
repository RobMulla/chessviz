<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <div class="top">
    Chess Visualization
  </div>

  <title class='title'>Chess Viz Final Project</title>
  <meta name="description" content="W209 Final Project">
  <meta name="author" content="Students">

  <!-- Our CSS -->
  <link href="./css/chessviz.css" rel="stylesheet"> <!-- For chess viz -->

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- Bootstrap JS -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>

<body>

  <!-- Load JS libraries -->
  <script src="https://d3js.org/d3.v3.min.js"></script> <!-- D3 -->
  <script src="./js/lib/ChessDataViz.js"></script>  <!-- For chess viz -->
  <script src="http://d3js.org/queue.v1.min.js"></script> <!-- for queue -->

  <!-- DROPDOWN MENUS-->
  <div class="left">
    <div class="select-style">
      <p> Select Viz Type:</p>
      <select id="viz_type" name="viz_type">
        <option value ="MovePaths" selected>Move Paths</option>
        <option value ="HeatMap">Heatmap</option>
      </select>​
    </div>

    <p> Choose Grand Master:</p>
    <div class="select-style">
      <select id="json_sources" name="json_sources">
        <option value ="./data/json/stats/Kasparov_stats.json" selected>Kasparov</option>
        <option value ="./data/json/stats/Carlsen_stats.json">Carlsen</option>
        <option value ="./data/json/stats/Fischer_stats.json">Fischer</option>
        <option value ="./data/json/stats/Karpov_stats.json">Karpov</option>
        <option value ="./data/json/stats/Capablanca_stats.json">Capablanca</option>
        <option value ="./data/json/stats/Lasker_stats.json">Lasker</option>
        <option value ="./data/json/stats/Morphy_stats.json">Morphy</option>
        <option value ="./data/json/stats/Kramnik_stats.json">Kramnik</option>
        <option value ="./data/json/stats/Botvinnik_stats.json">Botvinnik</option>
        <option value ="./data/json/stats/test.json">Test</option>

      </select>​
    </div>

    <p> If you selected move paths, change piece here:</p>

    <div class="select-style">
      <select id="piece_selector" name="piece_selector">
        <option value ="a2" selected>a2</option>
        <option value ="b2">b2</option>
        <option value ="c2">c2</option>
        <option value ="d2">d2</option>
        <option value ="e2">e2</option>
        <option value ="f2">f2</option>
        <option value ="g2">g2</option>
        <option value ="h2">h2</option>
        <option value ="a7">a7</option>
        <option value ="b7">b7</option>
        <option value ="c7">c7</option>
        <option value ="d7">d7</option>
        <option value ="e7">e7</option>
        <option value ="f7">f7</option>
        <option value ="g7">g7</option>
        <option value ="h7">h7</option>
        
        <!-- Major Pieces -->
        <option value ="Nb1">Nb1</option>
        <option value ="Nb8">Nb8</option>
        <option value ="Ng1">Ng1</option>
        <option value ="Nb1">Ng8</option>
        <option value ="Bc1">Bc1</option>
        <option value ="Bc8">Bc8</option>
        <option value ="Bf1">Bf1</option>
        <option value ="Bf8">Bf8</option>
        <option value ="Ra1">Ra1</option>
        <option value ="Ra8">Ra8</option>
        <option value ="Rh1">Rh1</option>
        <option value ="Rh8">Rh8</option>
        <option value ="Qd1">Qd1</option>
        <option value ="Qd8">Qd8</option>
        <option value ="Ke1">Ke1</option>
        <option value ="Ke8">Ke8</option>
      </div>

      <div class="select-style">
      </select>​
      <p> If you selected heatmap, choose player color and piece here:</p>
      <select id="heatmap_color" name="heatmap_color">
        <option value ="w" selected>white</option>
        <option value ="b">black</option>
      </select>​
    </div>

    <div class="select-style">
      <select id="heatmap_piece" name="heatmap_piece">
        <option value ="all" selected>all</option>
        <option value ="k">King</option>
        <option value ="q">Queen</option>
        <option value ="r">Rook</option>
        <option value ="n">Knight</option>
        <option value ="b">Bishop</option>
        <option value ="p">Pawn</option>
      </select>​
    </div>

  </div>
  
  <!-- MAIN BOARD -->
  <div class="main">
    <div id="chess_board" class="cdv-move-paths"></div>

    <div>

      <script>

        // create d3 selectors for the various dropdown elements in the DOm
        var dropdown = d3.select("#json_sources")
        var pieceselection = d3.select("#piece_selector")
        var hmcolor = d3.select("#heatmap_color")
        var hmpiece = d3.select("#heatmap_piece")
        var viztypeselector = d3.select("#viz_type")

        var change = function() {

          // Grab current state of the dropdowns
          var source = dropdown.node().options[dropdown.node().selectedIndex].value;
          var piece = pieceselection.node().options[pieceselection.node().selectedIndex].value;
          var heatmapcolor = hmcolor.node().options[hmcolor.node().selectedIndex].value;
          var heatmappiece = hmpiece.node().options[hmpiece.node().selectedIndex].value;
          var viztype = viztypeselector.node().options[viztypeselector.node().selectedIndex].value;

          // Grab current state of the menu?

          console.log("PIECE SELECTION:",piece)
          d3.json(source, function(json) {
            console.log("PLAYER SELECTION:",source)
            console.log("HEATMAP PIECE", heatmappiece)
            console.log("HEATMAP COLOR",heatmapcolor)
            console.log("Viz Type:",viztype)

            d3.json(source, function(err, data) {

              var defaultMovePathsOptions = {
                width: 700,
                margin: 20,
                accessor: piece,
                binSize: 1,
                pointRandomizer: d3.random.normal(3, 1),
                bezierRandomizer: d3.random.normal(12, 4),
                bezierScaleFactor: 2
              };

              var defaultHeatmapOptions = {
                width: 700,
                margin: 20,
                accessor: {
                  piece: heatmappiece,
                  color: heatmapcolor
                },
                sizeScale: true,
                colorScale: ['blue', 'red']
              };
              if  (viztype == 'MovePaths') {
                console.log("IN MOVE PATHS")
                var chessboardviz = new ChessDataViz.MovePaths('#chess_board', defaultMovePathsOptions, data.moves);
              }
              else {
                var chessboardviz = new ChessDataViz.HeatMap('#chess_board', defaultHeatmapOptions, data.heatmaps.squareUtilization);
                var tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([25, -6])
                .html(function(d) {
                  return d;
                });

                heatmapExample2.dispatch.on('mouseenter', tip.show);
                heatmapExample2.dispatch.on('mouseleave', tip.hide);
                heatmapExample2.dataContainer.call(tip);

                var wButton = d3.select('#w-btn');
                var bButton = d3.select('#b-btn');

                wButton.on('click', function() {
                  heatmapExample2.options({
                    accessor: {
                      color: 'w',
                      piece: 'q'
                    }
                  });

                  wButton.classed('button-primary', true);
                  bButton.classed('button-primary', false);
                });

                bButton.on('click', function() {
                  heatmapExample2.options({
                    accessor: {
                      color: 'b',
                      piece: 'q'
                    }
                  });

                  wButton.classed('button-primary', false);
                  bButton.classed('button-primary', true);
                });

              }

          // var chessboardviz = new ChessDataViz.MovePaths('#chess_board', defaultOptions, data.moves);

        });
          })

        }

        dropdown.on("change", change)
        pieceselection.on("change", change)
        hmcolor.on("change", change)
        hmpiece.on("change", change)
        viztypeselector.on("change", change)

change(); //trigger json on load

</script>

</div>

<div id="piece_icons">
<img src="/img/pieces.png" alt="pieces" usemap="#piecesmap" align="middle" >

<map name="piecesmap">
    <area alt="a2" title="" playercolor="w" href="#" shape="rect" coords="2,4,102,99" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="b2" title="" playercolor="w" href="#" shape="rect" coords="104,5,199,99" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="c2" title="" href="#" shape="rect" coords="201,5,298,98" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="d2" title="" href="#" shape="rect" coords="299,4,397,99" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="e2" title="" href="#" shape="rect" coords="398,2,497,100" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="f2" title="" href="#" shape="rect" coords="498,3,595,98" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="g2" title="" href="#" shape="rect" coords="596,2,694,98" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="h2" title="" href="#" shape="rect" coords="697,5,792,96" onclick="pieceSelect(alt, 'p', 'w')" />
    <area alt="Ra1" title="" href="#" shape="rect" coords="2,103,102,196" onclick="pieceSelect(alt, 'r', 'w')" />
    <area alt="Nb1" title="" href="#" shape="rect" coords="105,101,200,194" onclick="pieceSelect(alt, 'n', 'w')" />
    <area alt="Bc1" title="" href="#" shape="rect" coords="201,100,298,194" onclick="pieceSelect(alt, 'b', 'w')" />
    <area alt="Ke1" title="" href="#" shape="rect" coords="300,100,398,195" onclick="pieceSelect(alt, 'k', 'w')" />
    <area alt="Qd1" title="" href="#" shape="rect" coords="399,101,496,195" onclick="pieceSelect(alt, 'q', 'w')" />
    <area alt="Bf1" title="" href="#" shape="rect" coords="499,101,595,195" onclick="pieceSelect(alt, 'b', 'w')" />
    <area alt="Ng1" title="" href="#" shape="rect" coords="597,100,695,195" onclick="pieceSelect(alt, 'n', 'w')" />
    <area alt="Rh1" title="" href="#" shape="rect" coords="697,100,791,194" onclick="pieceSelect(alt, 'r', 'w')" />
    <area alt="a7" title="" href="#" shape="rect" coords="3,198,101,291" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="b7" title="" href="#" shape="rect" coords="103,199,201,290" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="c7" title="" href="#" shape="rect" coords="203,198,297,291" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="d7" title="" href="#" shape="rect" coords="299,198,397,292" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="e7" title="" href="#" shape="rect" coords="399,197,498,292" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="f7" title="" href="#" shape="rect" coords="499,197,595,291" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="g7" title="" href="#" shape="rect" coords="597,198,695,292" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="h7" title="" href="#" shape="rect" coords="696,198,795,291" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="Ra8" title="" href="#" shape="rect" coords="3,294,102,386" onclick="pieceSelect(alt, 'p', 'b')" />
    <area alt="Nb8" title="" href="#" shape="rect" coords="102,293,199,384" onclick="pieceSelect(alt, 'r', 'b')" />
    <area alt="Bc8" title="" href="#" shape="rect" coords="201,293,298,384" onclick="pieceSelect(alt, 'n', 'b')" />
    <area alt="Qd8" title="" href="#" shape="rect" coords="299,294,397,384" onclick="pieceSelect(alt, 'k', 'b')" />
    <area alt="Ke8" title="" href="#" shape="rect" coords="400,294,498,384" onclick="pieceSelect(alt, 'q', 'b')" />
    <area alt="Bf8" title="" href="#" shape="rect" coords="501,295,596,384" onclick="pieceSelect(alt, 'b', 'b')" />
    <area alt="Ng8" title="" href="#" shape="rect" coords="599,294,695,384" onclick="pieceSelect(alt, 'n', 'b')" />
    <area alt="Rh8" title="" href="#" shape="rect" coords="697,294,792,386" onclick="pieceSelect(alt, 'r', 'b')" />

</map>

<script type="text/javascript" name="click piece script">
function pieceSelect(movePathPiece, heatMapPiece, playerColor){
  console.log("Movepath piece is: ",movePathPiece," Heatmap piece is: ",heatMapPiece, " Player color is: ",playerColor)
  document.getElementById('piece_selector').value=movePathPiece
  document.getElementById('heatmap_piece').value=heatMapPiece
  document.getElementById('heatmap_color').value=playerColor
  change();
}

</script>
</div>

</body>
